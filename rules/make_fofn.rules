rule make_fofn:
    input:
        "units.tsv"
    output:
        "fofn/dosage_plots.fofn",
        "fofn/bedfiles.fofn"
    run:
        samples = {}
        bedfiles = []
        plots = []
        with open("units.tsv", 'r') as f:
            f.readline() # header
            
            # hash of sample-unit combinations
            for line in f:
                l = line.split('\t')
                if l[0] in samples.keys():
                    samples[l[0]].append("{}-{}".format(l[0],l[1]))
                else:
                    samples[l[0]] = ["{}-{}".format(l[0],l[1])]
        
        for i in samples.items():
            bedfiles.append("data/bedtools_coverage/{}-windowcov.bed".format(i[0]))
            plots.append("data/plots/{}-dosage_plot.pdf".format(i[0]))
            o = open("fofn/{}-units.fofn".format(i[0]), 'w')
            out = ["data/dedup/{}.bam".format(x) for x in i[1]]
            o.write('\n'.join(out)+'\n')
            o.close()
        
        o2 = open("fofn/bedfiles.fofn", 'w')
        o2.write('\n'.join(bedfiles)+'\n')
        o2.close()
        o3 = open("fofn/dosage_plots.fofn", 'w')
        o3.write('\n'.join(plots)+'\n')
        o3.close()
